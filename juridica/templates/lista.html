{% extends "base.html" %}
{% block contenido %}
    {% load static %}


<style>
.sheet-wrap{
  position: relative;
  perspective: 1200px;
  transition: height .45s cubic-bezier(.22,1,.36,1);

}

/* por defecto: overlay (no da altura) */
.sheet{
  position: absolute;
  inset: 0;
  backface-visibility: hidden;
  transform-style: preserve-3d;
  transition: transform .95s cubic-bezier(.22,1,.36,1), opacity .45s ease;
  opacity: 0;
  pointer-events: none;
}

/* la activa S√ç da altura al wrap */
.sheet.is-active{
  position: relative;  /* clave */
  inset: auto;         /* por si acaso */
  opacity: 1;
  pointer-events: auto;
  transform: translateX(0) translateZ(0);
  z-index: 2;
}

/* para que la entrante se vea mientras anima (sigue siendo absolute) */
.sheet.is-animating-in{
  opacity: 1;
  pointer-events: none;
  z-index: 3;
}



.sheet.enter-from-right{ transform: translateX(25px) translateZ(-120px); }
.sheet.enter-from-left{  transform: translateX(-25px) translateZ(-120px); }

.sheet.leave-to-left{  transform: translateX(-25px) translateZ(-120px); opacity: 0; z-index: 1; }
.sheet.leave-to-right{ transform: translateX(25px) translateZ(-120px);  opacity: 0; z-index: 1; }


.sheet.is-active{ transform: translateX(0) translateZ(0); }


</style>



<div class="mx-3">
  <div class="btn-group" role="group">
    <input type="radio" class="btn-check" name="vistaSel" id="folioView" value="folio" checked>
    <label class="btn btn-outline-secondary" for="folioView">Folio</label>

    <input type="radio" class="btn-check" name="vistaSel" id="sumarioView" value="sumario">
    <label class="btn btn-outline-secondary" for="sumarioView">Sumario</label>
  </div>
</div>

<div class="sheet-wrap mt-3" id="sheetWrap">
  <div class="sheet-sizer" aria-hidden="true"></div>

  <div class="sheet card p-4 folio is-active">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="mb-0">üìÑ Registros Jur√≠dicos</h3>

          <div class="d-flex gap-2 align-items-center">
      <select id="tablaSelector" class="form-select form-select-sm" style="width:auto;">
        <option value="pendientes" selected>En Curso</option>
        <option value="historico">Hist√≥rico (Terminados)</option>
      </select>

      <a href="/crear/" class="btn btn-primary btn-sm">+ Nuevo Registro</a>
    </div>
  </div>

  <!-- Pendientes -->
  <div id="wrapPendientes">
    <table id="registrosTable" class="table table-hover table-bordered align-middle w-100">
      <thead>
        <tr>
          <th>Folio</th>
          <th>Oficio o Derivacion</th>
          <th>Departamento/s</th>
          <th>Fecha Oficio</th>
          <th>Fecha Respuesta Prevista</th>
          <th>D√≠as transcurridos</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Hist√≥rico -->
    <div id="wrapHistorico" class="d-none">
      <table id="historicoTable" class="table table-hover table-bordered align-middle w-100">
        <thead>
          <tr>
            <th>Folio</th>
            <th>Oficio o Derivacion</th>
            <th>Departamento/s</th>
            <th>Fecha Oficio</th>
            <th>Fecha Respuesta</th>
            <th>Acciones</th>

          </tr>
        </thead>
        <tbody></tbody>
      </table>

      
    </div>
    <br>
    </div>
 

  <div class="sheet card p-4 sumario">
    <div class="d-flex justify-content-between align-items-center mb-3">
      
    </div>
   <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="mb-0">üë§ Sumarios</h3>

          <div class="d-flex gap-2 align-items-center">
      <select id="tablaSelector" class="form-select form-select-sm" style="width:auto;">
        <option value="pendientes" selected>En Curso</option>
        <option value="historico">Hist√≥rico (Terminados)</option>
      </select>

      <a href="/crear/" class="btn btn-primary btn-sm">+ Nuevo Registro</a>
    </div>
  </div>

  <div id="wrapPendientes">
    <table id="registrosTable" class="table table-hover table-bordered align-middle w-100">
      <thead>
        <tr>
          <th>Folio</th>
          <th>Oficio o Derivacion</th>
          <th>Departamento/s</th>
          <th>Fecha Oficio</th>
          <th>Fecha Respuesta Prevista</th>
          <th>D√≠as transcurridos</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  </div>
</div>



<script>
  const wrap = document.getElementById('sheetWrap');
  const folioRadio = document.getElementById('folioView');
  const sumarioRadio = document.getElementById('sumarioView');

  const folioCard = document.querySelector('.sheet.folio');
  const sumarioCard = document.querySelector('.sheet.sumario');

  let ro = null;

  function setWrapHeight(el){
    // scrollHeight funciona bien para contenido largo
    wrap.style.height = el.scrollHeight + 'px';
  }

  function observeActive(el){
    if (ro) ro.disconnect();
    ro = new ResizeObserver(() => setWrapHeight(el));
    ro.observe(el);

    // set inicial (por si el observer tarda un tick)
    setWrapHeight(el);
  }

  function clearMotionClasses(el){
  el.classList.remove('enter-from-right','enter-from-left','leave-to-left','leave-to-right','is-animating-in');
}

function transitionTo(target){
  const incoming = target === 'folio' ? folioCard : sumarioCard;
  const outgoing = target === 'folio' ? sumarioCard : folioCard;
  if (incoming.classList.contains('is-active')) return;

  const forward = (target === 'folio');
  const enterClass = forward ? 'enter-from-right' : 'enter-from-left';
  const leaveClass = forward ? 'leave-to-left'   : 'leave-to-right';

  clearMotionClasses(incoming);
  clearMotionClasses(outgoing);

  // entrante: overlay visible mientras anima
  incoming.classList.add('is-animating-in', enterClass);
  incoming.offsetHeight; // reflow

  // saliente: deja de ser relative (is-active) y se anima como overlay
  outgoing.classList.remove('is-active');
  outgoing.classList.add(leaveClass);

  // dispara la entrada
  incoming.classList.remove(enterClass);

  setTimeout(() => {
    // al final, el entrante pasa a ser el que da altura real
    incoming.classList.remove('is-animating-in');
    incoming.classList.add('is-active');

    clearMotionClasses(outgoing);
  }, 1000);
}

function setHeightSmooth(px){
  requestAnimationFrame(() => {
    sheetWrap.style.height = px + 'px';
  });
}

  // estados iniciales
  observeActive(document.querySelector('.sheet.is-active'));

  folioRadio.addEventListener('change', () => transitionTo('folio'));
  sumarioRadio.addEventListener('change', () => transitionTo('sumario'));
</script>


{% block content %}
        {% include 'modal/modal.html' %}
{% endblock %}



<script src="{% static 'js/tabla.js' %}"></script>
<script src="{% static 'js/detalle.js' %}"></script>


{% endblock %}
